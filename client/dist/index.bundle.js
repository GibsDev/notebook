"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[826],{7137:(e,t,n)=>{var r=n(7294),a=n(3935),s=n(5367),o=n(8330),i=n(9896),c=n(7243),l=n(3768),u=n(9711),d=n(6974),p=(n(5169),n(7369),n(5861)),f=n(8152),m=n(7757),h=n.n(m),x=n(5697),g=n.n(x),v=n(4586),y=n(9249),b=n(9098),w=n(6252),j=n(5893),k=(0,b.Ps)("\nquery {\n    getUser {\n        id\n        nickname\n        collapseNotes\n        username\n        address\n    }\n}"),N=(0,b.Ps)("\nmutation ($nickname: String = null) {\n    setNickname(nickname: $nickname)\n}"),C=(0,b.Ps)("\nmutation ($collapse: Boolean) {\n    setCollapseNotes(collapse: $collapse)\n}"),S=(0,r.createContext)();function Z(e){var t=e.children,a=(0,w.x)(),s=(new AbortController).signal,o=(0,r.useState)({id:void 0,nickname:void 0,collapseNotes:null,username:null,address:null}),i=(0,f.Z)(o,2),c=i[0],l=c.id,u=c.nickname,d=c.collapseNotes,m=c.username,x=c.address,g=i[1];function b(){return Z.apply(this,arguments)}function Z(){return(Z=(0,p.Z)(h().mark((function e(){var t,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.query({query:k});case 3:t=e.sent,n=t.data.getUser,g(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),g({id:null,nickname:null,collapseNotes:null,username:null,address:null});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function A(){return E.apply(this,arguments)}function E(){return(E=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/auth/logout",{method:"post"});case 2:b();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return $.apply(this,arguments)}function $(){return($=(0,p.Z)(h().mark((function e(t){var r,a,s,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.e(99).then(n.t.bind(n,2099,23)),y.Am.promise(r,{pending:"Loading web3-token bundle...",error:"Failed to load web3-token bundle"}),e.next=4,r;case 4:if(a=e.sent,s=a.default,ethereum){e.next=8;break}throw new Error("MetaMask not found");case 8:return e.next=10,ethereum.request({method:"eth_requestAccounts"});case 10:return o=function(e){return ethereum.request({method:"personal_sign",params:[ethereum.selectedAddress,e]})},e.abrupt("return",s.sign(o,{expires_in:t,request_id:(0,v.Z)()}));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=(0,p.Z)(h().mark((function e(){var t,n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O("1d");case 2:t=e.sent,(n=new Date).setDate(n.getDate()+1),r=n.toUTCString(),document.cookie="web3=".concat(t,"; expires=").concat(r," SameSite=Strict;"),ethereum.on("accountsChanged",A),b();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return D=(0,p.Z)(h().mark((function e(t,n){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/auth/register",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({username:t,password:n}),signal:s});case 2:if(!(r=e.sent).ok){e.next=7;break}return e.abrupt("return","Login '".concat(t,"' created"));case 7:if(429!==r.status){e.next=11;break}throw new Error("Too many requests, try again in 5 minutes");case 11:throw new Error(JSON.stringify(r));case 12:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function I(){return I=(0,p.Z)(h().mark((function e(t,n){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=3;break}return e.next=3,A();case 3:return e.next=5,fetch("/auth/login",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({username:t,password:n}),signal:s});case 5:if(!(r=e.sent).ok){e.next=10;break}b(),e.next=13;break;case 10:if(429!==r.status){e.next=12;break}throw new Error("Too many attempts, try again later");case 12:throw new Error("Invalid login");case 13:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function L(){return(L=(0,p.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==u){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.mutate({mutation:N,variables:{nickname:t}});case 4:b();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return(U=(0,p.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.mutate({mutation:C,variables:{collapse:t}});case 2:b();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,r.useEffect)((function(){return b(),function(){}}),[]),(0,j.jsx)(S.Provider,{value:{user:l,nickname:u,username:m,address:x,collapseNotes:d,setCollapsedByDefault:function(e){return U.apply(this,arguments)},changeNickname:function(e){return L.apply(this,arguments)},login:function(e,t){return I.apply(this,arguments)},register:function(e,t){return D.apply(this,arguments)},walletLogin:function(){return P.apply(this,arguments)},walletToken:O,logout:A},children:t})}function A(e){var t=e.children,n=(0,r.useContext)(S).user,a=(0,d.s0)();function s(){null===n&&a("/login")}return(0,r.useEffect)((function(){s()}),[]),(0,r.useEffect)((function(){s()}),[n]),t}Z.propTypes={children:g().element};var E=(0,y.vU)({collapse:!1,enter:"animate__fadein",exit:"animate__fadeout"});function O(){return(0,j.jsx)(y.Ix,{transition:E,closeOnClick:!0,position:"bottom-center",autoClose:3e3,pauseOnHover:!0})}function $(){var e=(0,r.useContext)(S).logout;return(0,j.jsx)("button",{className:"btn btn-outline-danger w-100",onClick:e,children:"Logout"})}function P(){var e=(0,r.useContext)(S),t=e.user,n=e.nickname,a=e.username,s=e.address,o=s?s.substring(0,6):null,i=n||a||o||"User";return t?(0,j.jsxs)("div",{className:"dropdown",children:[(0,j.jsx)("button",{className:"btn btn-dark dropdown-toggle px-0",type:"button",id:"userDropdown","data-bs-toggle":"dropdown","aria-expanded":"false",children:i}),(0,j.jsxs)("ul",{className:"dropdown-menu dropdown-menu-dark dropdown-menu-end","aria-labelledby":"userDropdown",children:[(0,j.jsx)("li",{children:(0,j.jsx)(u.rU,{className:"dropdown-item",to:"/settings",children:"Settings"})}),(0,j.jsx)("li",{children:(0,j.jsx)("hr",{className:"dropdown-divider"})}),(0,j.jsx)("li",{className:"px-3",children:(0,j.jsx)($,{})})]})]}):null}function D(){var e=(0,r.useContext)(S),t=e.user,n=e.login,a=e.register,s=e.walletLogin,o=(0,r.useState)(""),i=(0,f.Z)(o,2),c=i[0],l=i[1],u=(0,r.useState)(""),m=(0,f.Z)(u,2),x=m[0],g=m[1],v=(0,r.useState)(!1),b=(0,f.Z)(v,2),w=b[0],k=b[1],N=(0,d.s0)(),C=new AbortController,Z=C.signal;function A(){return(A=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/auth/username/"+c,{signal:Z});case 2:e.sent.ok?k(!0):k(!1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s();case 3:N("/"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.Am.error(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function O(){return(O=(0,p.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=n(c,x),y.Am.promise(t,{pending:"Logging in...",success:"Successfully logged in",error:"Unable to login"}),e.next=5,t;case 5:N("/"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),y.Am.error(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function $(){return($=(0,p.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a(c,x);case 3:t=e.sent,(0,y.Am)(t),k(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),y.Am.error(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}return(0,r.useEffect)((function(){return function(){C.abort()}}),[]),(0,r.useEffect)((function(){return t&&N("/"),function(){l(""),g("")}}),[t]),(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{className:"d-flex flex-column gap-2 my-3",children:[(0,j.jsxs)("div",{className:"d-flex flex-column gap-2",children:[(0,j.jsx)("h2",{children:"Login or Register"}),(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("span",{className:"input-group-text",id:"username",children:"Username"}),(0,j.jsx)("input",{className:"form-control",type:"text",value:c,placeholder:"Username","aria-label":"Username","aria-describedby":"username",onChange:function(e){l(e.target.value),k(!1)},onBlur:function(){return A.apply(this,arguments)}})]}),(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("span",{className:"input-group-text",id:"password",children:"Password"}),(0,j.jsx)("input",{className:"form-control",type:"password",value:x,placeholder:"Password","aria-label":"Password","aria-describedby":"password",onChange:function(e){g(e.target.value)}})]})]}),(0,j.jsxs)("div",{className:"d-flex gap-2",children:[(0,j.jsx)("button",{className:"btn btn-secondary flex-grow-1",disabled:!c||!x,onClick:w?function(){return O.apply(this,arguments)}:function(){return $.apply(this,arguments)},children:w?"Login":"Register"}),(0,j.jsx)("button",{className:"btn btn-secondary flex-grow-1",onClick:function(){return E.apply(this,arguments)},children:"Connect wallet"})]})]})})}var I=n(1954);function L(e){var t=e.onApply,n=e.onCancel;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("button",{className:"btn btn-outline-success",onClick:t,title:"Apply",children:(0,j.jsx)(I.JO,{icon:"bi:check"})}),(0,j.jsx)("button",{className:"btn btn-outline-warning",onClick:n,children:(0,j.jsx)(I.JO,{icon:"ci:undo"})})]})}L.propTypes={onApply:g().func,onCancel:g().func};const U=L;function q(){var e=(0,r.useContext)(S),t=e.user,n=e.nickname,a=e.collapseNotes,s=e.changeNickname,o=e.setCollapsedByDefault,i=e.username,c=e.address,l=e.walletToken,u=(0,r.useState)(!1),d=(0,f.Z)(u,2),m=d[0],x=d[1];function g(){return n||""}var v=(0,r.useState)(g()),b=(0,f.Z)(v,2),w=b[0],k=b[1];function N(){k(g()),s(w||null)}function C(){return(C=(0,p.Z)(h().mark((function e(){var t,n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l("1m");case 2:return t=e.sent,e.next=5,fetch("/auth/link",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({token:t})});case 5:if((n=e.sent).ok){e.next=14;break}return e.next=9,n.text();case 9:r=e.sent,y.Am.error(r),console.error(r),e.next=19;break;case 14:return e.t0=y.Am,e.next=17,n.text();case 17:e.t1=e.sent,(0,e.t0)(e.t1);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,r.useEffect)((function(){k(n||"")}),[n]),(0,r.useEffect)((function(){(i||c)&&x(null!==i)}),[i,c]),(0,j.jsxs)("div",{className:"d-flex flex-column gap-2 my-3",children:[(0,j.jsx)("h2",{children:"Settings"}),(0,j.jsxs)("p",{className:"mb-0",children:["You are logged in as ",(0,j.jsx)("code",{children:t})]}),(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("span",{className:"input-group-text",if:"nickname",children:"Nickname"}),(0,j.jsx)("input",{className:"form-control",type:"text","aria-label":"Nickname","area-described-by":"nickname",value:w,onChange:function(e){k(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(N(),e.target.blur())}}),w!==g()&&(0,j.jsx)(U,{onCancel:function(){k(g())},onApply:N})]}),(0,j.jsxs)("div",{className:"input-group d-flex",children:[(0,j.jsx)("span",{className:"input-group-text flex-grow-1",id:"collapseLabel",children:"Collapse notes by default"}),(0,j.jsx)("div",{className:"input-group-text",children:(0,j.jsx)("input",{type:"checkbox",className:"for-check-input","aria-labelledby":"collapseLabel",onChange:function(e){o(e.currentTarget.checked)},checked:a})})]}),m&&(0,j.jsx)("button",{className:"btn btn-secondary",onClick:function(){return C.apply(this,arguments)},children:"Link wallet"})]})}var T=n(2153),F=n.n(T),K=n(4431),z=n(5059),J=n(319),B=n(4942),M=n(4925),R=["icon","variant","label","className","href","size"];function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){(0,B.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e){var t=e.icon,n=e.variant,r=e.label,a=e.className,s=e.href,o=e.size,i=(0,M.Z)(e,R),c="";"sm"===o?c="btn-sm":"lg"===o&&(c="btn-lg");var l=G({className:"btn btn-".concat(n||"outline-secondary"," ").concat(c," ").concat(a||"").trim()},i);return s?(0,j.jsxs)("a",G(G({href:s,target:"_blank",rel:"noreferrer"},l),{},{children:[r,(0,j.jsx)(I.JO,{icon:t})]})):(0,j.jsxs)("button",G(G({},l),{},{children:[r,(0,j.jsx)(I.JO,{icon:t})]}))}W.propTypes={icon:g().string.isRequired,variant:g().oneOf([void 0,"primary","outline-primary","secondary","outline-secondary","success","outline-success","danger","outline-danger","warning","outline-warning","info","outline-info","light","outline-light","dark","outline-dark","link","outline-link"]),label:g().string,className:g().string,href:g().string,size:g().oneOf(["sm","lg",void 0])};const Q=W;var V=n(858),H="lucide:clipboard";function Y(e){try{new URL(e)}catch(e){return!1}return!0}var X=(0,b.Ps)("\nquery ($id: String){\n    getField(id: $id) {\n        name\n        data\n        secret\n    }\n}"),ee=(0,b.Ps)("\nmutation ($id: String!, $name: String, $data: String, $secret: Boolean) {\n    updateField(id: $id, name: $name, data: $data, secret: $secret) {\n        name\n        data\n        secret\n    }\n}"),te=(0,b.Ps)("\nmutation ($id: String!, $relativeIndex: Int!) {\n    moveField(id: $id, relativeIndex: $relativeIndex)\n}"),ne=(0,b.Ps)("\nmutation ($id: String!) {\n    deleteField(id: $id) {\n        id\n    }\n}");function re(e){var t=e.className,n=e.id,a=e.encryptionKey,s=e.onDeleted,o=e.onMoved,i=e.editable,c=void 0!==i&&i,l=(0,w.x)(),u=(0,r.useState)(""),d=(0,f.Z)(u,2),m=d[0],x=d[1],g=(0,r.useState)(""),v=(0,f.Z)(g,2),y=v[0],b=v[1],k=(0,r.useState)(y),N=(0,f.Z)(k,2),C=N[0],S=N[1],Z=(0,r.useState)(m),A=(0,f.Z)(Z,2),E=A[0],O=A[1],$=(0,r.useState)(H),P=(0,f.Z)($,2),D=P[0],I=P[1],L=(0,r.useState)(!1),q=(0,f.Z)(L,2),T=q[0],F=q[1],B=(0,r.useState)(!0),M=(0,f.Z)(B,2),R=M[0],_=M[1],G=(0,K.t)(X,{variables:{id:n},onCompleted:function(){var e=ae.data.getField,t=le(e.name),n=le(e.data);c||t||n?(O(t),S(n),x(t),b(n),_(e.secret)):oe()}}),W=(0,f.Z)(G,2),re=W[0],ae=W[1],se=(0,J.D)(ne,{variables:{id:n},onCompleted:function(){s()}}),oe=(0,f.Z)(se,1)[0],ie=(0,V.Z)(a),ce=ie.encrypt,le=ie.decrypt;function ue(){b(C),x(E)}function de(){return pe.apply(this,arguments)}function pe(){return(pe=(0,p.Z)(h().mark((function e(){var t,r,a,s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.mutate({mutation:ee,variables:{id:n,name:ce(m),data:ce(y)}});case 3:t=e.sent,r=t.data.updateField,a=le(r.name),s=le(r.data),O(a),S(s),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function fe(e){"Enter"===e.key?(de(),e.target.blur()):"Escape"===e.key&&(x(E),b(C),e.target.blur())}function me(){return(me=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.mutate({mutation:te,variables:{id:n,relativeIndex:-1}});case 2:o();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(){return(he=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.mutate({mutation:te,variables:{id:n,relativeIndex:1}});case 2:o();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){return(xe=(0,p.Z)(h().mark((function e(){var t,r,a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(!(t=R)),e.prev=2,e.next=5,l.mutate({mutation:ee,variables:{id:n,secret:!t}});case 5:r=e.sent,a=r.data.updateField.secret,_(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}return(0,r.useEffect)((function(){return re(),function(){}}),[]),(0,r.useEffect)((function(){c||(!ae.called||ae.loading||!ae.data||E||C?ue():oe())}),[c]),(0,r.useEffect)((function(){D!=H&&setTimeout((function(){I(H)}),1500)}),[D]),(0,j.jsxs)("div",{className:("input-group "+t).trim(),children:[c&&T&&(0,j.jsx)("button",{className:"btn btn-danger delete-button",title:"Confirm Delete",onClick:oe,children:"Delete"}),c&&(0,j.jsx)(Q,{title:"Move Up",size:"sm",icon:"bi:arrow-up-short",onClick:function(){return me.apply(this,arguments)}}),c&&(0,j.jsx)(Q,{title:"Move Down",size:"sm",icon:"bi:arrow-down-short",onClick:function(){return he.apply(this,arguments)}}),c?(0,j.jsx)("input",{className:"form-control",autoComplete:"off",value:m,onChange:function(e){c&&x(e.target.value)},onKeyDown:fe}):(0,j.jsx)("span",{className:"input-group-text",children:m}),!c&&(0,j.jsx)(Q,{tabIndex:-1,title:"Copy",icon:D,onClick:function(){z.Z.write(C).then((function(){I("lucide:clipboard-check")}))}}),(R||c)&&(0,j.jsx)(Q,{className:R&&!c?"flex-grow-1":"",tabIndex:-1,size:"sm",icon:R&&c?"ic:outline-visibility":"ic:outline-visibility-off",onClick:function(){return xe.apply(this,arguments)},title:R?"Show Data":"Hide Data",disabled:R&&!c}),(c||!R)&&(0,j.jsx)("input",{type:R?"password":"text",className:"form-control bg-white",autoComplete:"off",value:y,onChange:function(e){c&&b(e.target.value)},onKeyDown:fe,"aria-label":m,"aria-describedby":n,readOnly:!c}),c&&(y!==C||m!==E)&&(0,j.jsx)(U,{onApply:de,onCancel:ue}),c&&(0,j.jsx)(Q,{icon:"carbon:delete",size:"sm",onClick:function(){T||document.addEventListener("click",(function(e){e.target&&e.target.className&&e.target.className.includes&&e.target.className.includes("delete-button")||(F(!1),e.stopPropagation())}),{capture:!0,once:!0}),F(!T)},title:"Delete"}),!c&&Y(C)&&(0,j.jsx)(Q,{icon:"ci:external-link",href:C})]})}re.propTypes={className:g().string,id:g().string,encryptionKey:g().string,onDeleted:g().func,onMoved:g().func,editable:g().bool};const ae=re;var se=(0,b.Ps)("\nquery ($id: String) {\n    getNote(id: $id) {\n        title\n        body\n        createdAt\n        updatedAt\n        fields {\n            id\n            index\n        }\n    }\n}"),oe=(0,b.Ps)("\nmutation ($id: String!, $title: String, $body: String) {\n    updateNote(id: $id, title: $title, body: $body) {\n        title\n        body\n    }\n}"),ie=(0,b.Ps)("\nmutation ($noteId: String!) {\n    createField(noteId: $noteId) {\n        id\n    }\n}"),ce=(0,b.Ps)("\nmutation ($id: String!) {\n    deleteNote(id: $id)\n}");function le(e){var t=e.className,n=e.id,a=e.encryptionKey,s=e.query,o=e.onDeleted,i=(0,w.x)(),c=(0,r.useContext)(S).collapseNotes,l=(0,r.useState)(void 0),u=(0,f.Z)(l,2),d=u[0],m=u[1],x=(0,r.useState)(d),g=(0,f.Z)(x,2),v=g[0],b=g[1],k=(0,r.useState)(void 0),N=(0,f.Z)(k,2),C=N[0],Z=N[1],A=(0,r.useState)(C),E=(0,f.Z)(A,2),O=E[0],$=E[1],P=(0,r.useState)([]),D=(0,f.Z)(P,2),I=D[0],L=D[1],q=(0,r.useState)(!1),T=(0,f.Z)(q,2),F=T[0],z=T[1],J=(0,r.useState)(c),B=(0,f.Z)(J,2),M=B[0],R=B[1],_=(0,r.useState)(!1),G=(0,f.Z)(_,2),W=G[0],H=G[1],Y=(0,r.useState)(!0),X=(0,f.Z)(Y,2),ee=X[0],te=X[1],ne=(0,r.useState)(null),re=(0,f.Z)(ne,2),le=re[0],ue=re[1],de=(0,r.useState)(null),pe=(0,f.Z)(de,2),fe=pe[0],me=pe[1],he=(0,V.Z)(a),xe=he.encrypt,ge=he.decrypt,ve=(0,K.t)(se,{variables:{id:n},onCompleted:function(e){be(e.getNote)}}),ye=(0,f.Z)(ve,1)[0];function be(e){var t=e.title,n=e.body,r=e.createdAt,a=e.updatedAt,s=e.fields;if(t){var o=ge(t);void 0===d&&m(o),b(o)}if(n){var i=ge(n);void 0===C&&Z(i),$(i)}if(s){var c=s.map((function(e){return e.id}));L(c)}r&&ue(new Date(r)),a&&me(new Date(a))}if((0,r.useEffect)((function(){return ye(),function(){}}),[]),(0,r.useEffect)((function(){te(!s||v&&v.toLowerCase().includes(s.toLowerCase())||O&&O.toLowerCase().includes(s.toLowerCase()))}),[s,v,O]),(0,r.useEffect)((function(){Ne()}),[F]),!ee)return null;function we(){return je.apply(this,arguments)}function je(){return(je=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.mutate({mutation:oe,variables:{id:n,title:xe(d)}});case 3:be(e.sent.data.updateNote),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function ke(){return(ke=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.mutate({mutation:oe,variables:{id:n,body:xe(C)}});case 3:be(e.sent.data.updateNote),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function Ne(){Z(O),m(v),H(!1)}function Ce(){return(Ce=(0,p.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.mutate({mutation:ie,variables:{noteId:n}});case 3:ye(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function Se(){return(Se=(0,p.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.mutate({mutation:ce,variables:{id:n}});case 3:t=e.sent,o(t.data.deleteNote),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),y.Am.error(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}return(0,j.jsxs)("div",{className:("card "+t).trim(),children:[(0,j.jsxs)("div",{className:"card-header d-flex gap-2 align-items-center",children:[F&&W&&(0,j.jsx)("button",{className:"btn btn-danger delete-button",title:"Confirm Delete",onClick:function(){return Se.apply(this,arguments)},children:"Delete"}),F?(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("input",{className:"form-control",type:"text",value:d,placeholder:"Title",onChange:function(e){m(e.target.value)},onKeyDown:function(e){"Enter"===e.key?(we(),e.target.blur()):"Escape"===e.key&&(m(v),e.target.blur())}}),d!==v&&(0,j.jsx)(U,{onCancel:Ne,onApply:we})]}):(0,j.jsx)("span",{className:"card-text flex-grow-1",title:le&&fe&&"Updated: ".concat(fe.toLocaleString(),"\nCreated: ").concat(le.toLocaleString()),children:d}),F&&(0,j.jsx)(Q,{icon:"carbon:delete",size:"sm",title:"Delete Note",onClick:function(){W||document.addEventListener("click",(function(e){e.target&&e.target.className&&e.target.className.includes&&e.target.className.includes("delete-button")||(H(!1),e.stopPropagation())}),{capture:!0,once:!0}),H(!W)}}),(0,j.jsx)(Q,{icon:"ep:edit-pen",size:"sm",variant:F?"secondary":"outline-secondary",title:(F?"Exit":"Enter")+" Edit mode",onClick:function(){F||R(!1),z(!F)}}),(0,j.jsx)(Q,{size:"sm",icon:M?"bx:bx-expand-vertical":"bx:bx-collapse-vertical",title:M?"Expand":"Collapse",onClick:function(){M||z(!1),R(!M)}})]}),(0,j.jsxs)("div",{className:M?"d-none":"d-flex flex-column gap-3 card-body",children:[F?(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("textarea",{className:"form-control",placeholder:"Body",value:C,onChange:function(e){Z(e.target.value)},onKeyDown:function(e){"Escape"===e.key&&(Z(O),e.target.blur())}}),C!==O&&(0,j.jsx)(U,{onCancel:Ne,onApply:function(){return ke.apply(this,arguments)}})]}):C&&(0,j.jsx)("pre",{className:"card-text mb-0",style:{fontFamily:"inherit",fontSize:"inherit"},children:C}),(F||I.length>0)&&(0,j.jsxs)("div",{className:"d-flex flex-column gap-2",children:[I.map((function(e){return(0,j.jsx)(ae,{id:e,encryptionKey:a,editable:F,onDeleted:ye,onMoved:ye},e)})),F&&(0,j.jsx)(Q,{icon:"akar-icons:plus",title:"Add Field",onClick:function(){return Ce.apply(this,arguments)}})]})]})]})}le.propTypes={className:g().string,id:g().string,encryptionKey:g().string,query:g().string,onDeleted:g().func};const ue=le;var de=n(3144),pe=n(5671),fe=n(136),me=n(4575),he=n(1120),xe=n(2407),ge={backgroundColor:"var(--bs-secondary)",color:"var(--bs-light)",border:"1px solid var(--bs-secondary)"},ve={backgroundColor:"rgba(0,0,0,0)",color:"var(--bs-secondary)",border:"1px solid var(--bs-secondary)"};function ye(e,t,n,a){"string"==typeof n&&(n=(0,j.jsx)("span",{children:n}));var s=(0,r.useState)(e),o=(0,f.Z)(s,2),i=o[0],c=o[1];return[i,(0,j.jsxs)("div",{title:a,children:[(0,j.jsx)("input",{type:"checkbox",className:"btn-check",id:t,checked:i,autoComplete:"off",onChange:function(e){c(e.target.checked),e.target.blur()}}),(0,j.jsx)("label",{className:"btn",style:i?ge:ve,htmlFor:t,children:n})]})]}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var we="abcdefghijklmnopqrstuvwxyz",je="0123456789",ke="!@#$%^&*",Ne="_.,+-=:;?",Ce="<>[](){}",Se="/`\"|~'\\",Ze="lucide:clipboard";function Ae(e,t){if(e<0||t<0)throw new Error("min and max must be positive");if(t<e)throw new Error("max is not > min");return crypto.getRandomValues(new Uint32Array(1))[0]%(t-e+1)+e}function Ee(e,t,n){if(void 0===e)throw new Error("s is undefined");if(void 0===t)throw new Error("index is undefined");if(void 0===n)throw new Error("replacement is undefined");if("string"!=typeof n||1!==n.length)throw new Error("Invalid replacement character");return e.substr(0,t)+n+e.substr(t+n.length)}var Oe=function(e){(0,fe.Z)(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,he.Z)(t);if(n){var a=(0,he.Z)(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return(0,me.Z)(this,e)});function a(){var e;return(0,pe.Z)(this,a),(e=r.call(this,"Length is too short for constraints")).name="ConstraintSpaceError",e}return(0,de.Z)(a)}((0,xe.Z)(Error));function $e(){var e=ye(!0,"alpha","Alphabet"),t=(0,f.Z)(e,2),n=t[0],a=t[1],s=ye(!0,"num","Numbers"),o=(0,f.Z)(s,2),i=o[0],c=o[1],l=ye(!0,"specBase",ke,"Special base"),u=(0,f.Z)(l,2),d=u[0],p=u[1],m=ye(!0,"specExt",Ne,"Special extended"),h=(0,f.Z)(m,2),x=h[0],g=h[1],v=ye(!0,"specWrap",Ce,"Special wrap"),b=(0,f.Z)(v,2),w=b[0],k=b[1],N=ye(!1,"specObs",Se,"Special obscure"),C=(0,f.Z)(N,2),S=C[0],Z=C[1],A=(0,r.useState)(""),E=(0,f.Z)(A,2),O=E[0],$=E[1],P=ye(!0,"upper","Uppercase","At least one upper case character"),D=(0,f.Z)(P,2),L=D[0],U=D[1],q=ye(!0,"lower","Lowercase","At least one lower case character"),T=(0,f.Z)(q,2),F=T[0],K=T[1],J=ye(!0,"number","Number","At least one number character"),B=(0,f.Z)(J,2),M=B[0],R=B[1],_=ye(!0,"custom","Custom","At least one custom character"),G=(0,f.Z)(_,2),W=G[0],Q=G[1],V=(0,r.useState)(16),H=(0,f.Z)(V,2),Y=H[0],X=H[1],ee=(0,r.useState)(Ze),te=(0,f.Z)(ee,2),ne=te[0],re=te[1];return(0,r.useEffect)((function(){ne!=Ze&&setTimeout((function(){re(Ze)}),1500)}),[ne]),(0,j.jsx)("div",{className:"card bg-dark",children:(0,j.jsxs)("div",{className:"card-body text-white d-flex flex-column gap-3",children:[(0,j.jsx)("span",{children:"Character Pool"}),(0,j.jsxs)("div",{className:"d-flex flex-wrap gap-2 align-content-between",children:[a,c,p,g,k,Z,(0,j.jsxs)("div",{className:"input-group",title:"Custom characters",children:[(0,j.jsx)("span",{className:"input-group-text",children:"Custom"}),(0,j.jsx)("input",{type:"text",className:"form-control","aria-label":"Custom characters",value:O,onChange:function(e){return $(e.target.value)}})]})]}),(0,j.jsx)("span",{children:"Constraints"}),(0,j.jsxs)("div",{className:"d-flex flex-wrap gap-2 align-content-between",children:[U,K,R,Q,(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("span",{className:"input-group-text",children:"Length"}),(0,j.jsx)("input",{type:"number",className:"form-control","aria-label":"Length",value:Y,onChange:function(e){return X(e.target.value)}})]})]}),(0,j.jsxs)("button",{className:"btn btn-secondary",onClick:function(){var e="";n&&(e+=we),i&&(e+=je),d&&(e+=ke),x&&(e+=Ne),w&&(e+=Ce),S&&(e+=Se),O&&(e=(e=(e+=O).split("")).filter((function(e,t,n){return n.indexOf(e)===t})),e=e.join(""));for(var t=function(e,t){if(e.length>256)throw Error("charPool size too large for 8 bit integers");var n=new Uint8Array(t);crypto.getRandomValues(n);var r,a="",s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?be(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw s}}}}(n);try{for(s.s();!(r=s.n()).done;){var o=r.value;a+=e.charAt(o%e.length)}}catch(e){s.e(e)}finally{s.f()}return a}(e,Y),r=new Array(Y),a=0;a<Y;a++)r[a]=a;r=function(e){for(var t,n,r=e.length;r;)n=Ae(0,--r),t=e[r],e[r]=e[n],e[n]=t;return e}(r);try{if(L){var s=r.pop();if(void 0===s)throw new Oe;t=Ee(t,s,we.toUpperCase()[Ae(0,we.length-1)])}if(F){var o=r.pop();if(void 0===o)throw new Oe;t=Ee(t,o,we[Ae(0,we.length-1)])}if(M){var c=r.pop();if(void 0===c)throw new Oe;t=Ee(t,c,je[Ae(0,je.length-1)])}if(W&&O){var l=r.pop();if(void 0===l)throw new Oe;t=Ee(t,l,O[Ae(0,O.length-1)])}z.Z.write(t).then((function(){re("lucide:clipboard-check")})).catch((function(){y.Am.error("Could not copy to clipboard")}))}catch(e){e instanceof Oe?y.Am.error(e.message):console.error(e)}},children:["Generate ",(0,j.jsx)(I.JO,{icon:ne})]})]})})}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var De=(0,b.Ps)("\nquery ($keyId: String) {\n    getNotes(keyId: $keyId) {\n        id\n        updatedAt\n    }\n}"),Ie=(0,b.Ps)("\nmutation ($title: String, $keyId: String){\n    createNote(title: $title, keyId: $keyId) {\n        id\n    }\n}");function Le(){var e=(0,w.x)(),t=(0,r.useContext)(S).user,n=(0,r.useState)(""),a=(0,f.Z)(n,2),s=a[0],o=a[1],i=(0,r.useState)([]),c=(0,f.Z)(i,2),l=c[0],u=c[1],d=(0,r.useState)(""),m=(0,f.Z)(d,2),x=m[0],g=m[1],v=(0,r.useState)(""),y=(0,f.Z)(v,2),b=y[0],k=y[1],N=(0,r.useState)(null),C=(0,f.Z)(N,2),Z=C[0],A=C[1],E=(0,r.useState)(null),O=(0,f.Z)(E,2),$=O[0],P=O[1],D=(0,r.useState)(!1),L=(0,f.Z)(D,2),U=L[0],q=L[1],T=(0,V.Z)(Z).encrypt,z=(0,K.t)(De,{variables:{keyId:$},onCompleted:function(e){var t=e.getNotes.sort((function(e,t){var n=new Date(e.updatedAt).valueOf();return new Date(t.updatedAt).valueOf()-n})).map((function(e){return e.id}));u(t)}}),J=(0,f.Z)(z,1)[0];function B(){var e=t+b,n=F()(e).toString();A(n);var r=F()(n).toString();P(r)}function M(){return(M=(0,p.Z)(h().mark((function t(){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.mutate({mutation:Ie,variables:{title:T("Untitled note"),keyId:$}});case 3:n=t.sent,u([n.data.createNote.id].concat(l)),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0.message);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}function R(e){return _.apply(this,arguments)}function _(){return _=(0,p.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u(l.filter((function(e){return e!==t})));case 1:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function G(){k(x)}function W(){o("")}function H(){g(""),k("")}if((0,r.useEffect)((function(){B()}),[t]),(0,r.useEffect)((function(){t?B():(A(null),P(null))}),[b]),(0,r.useEffect)((function(){J()}),[$]),!t)return(0,j.jsx)("p",{className:"my-3",children:"You need to login to access this page"});if(!Z)return(0,j.jsx)("p",{className:"my-3",children:"Generating client encryption key..."});var Y,X=[],ee=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw s}}}}(l);try{for(ee.s();!(Y=ee.n()).done;){var te=Y.value;X.push((0,j.jsx)(ue,{encryptionKey:Z,query:s,id:te,onDeleted:R},te))}}catch(e){ee.e(e)}finally{ee.f()}return 0==X.length&&t&&(X=(0,j.jsx)("p",{children:"There are no notes available."})),(0,j.jsxs)("div",{className:"d-flex flex-column gap-3 my-3",children:[(0,j.jsxs)("div",{className:"d-flex gap-2 align-items-stretch",children:[(0,j.jsxs)("div",{className:"d-flex gap-2 flex-wrap flex-md-nowrap flex-grow-1",children:[(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("span",{className:"input-group-text",id:"key",title:"Key",children:(0,j.jsx)(I.JO,{icon:"codicon:key"})}),(0,j.jsx)("input",{className:"form-control",type:"password",placeholder:"Key",autoComplete:"new-password","aria-describedby":"key",value:x,onChange:function(e){return g(e.target.value)},onBlur:G,onKeyDown:function(e){"Enter"===e.key?(e.target.blur(),G()):"Escape"===e.key&&(e.target.blur(),H())}}),b!==x&&(0,j.jsx)(Q,{icon:"bi:check",variant:"outline-primary",title:"Apply",onClick:G}),b&&(0,j.jsx)(Q,{icon:"carbon:delete",variant:"outline-warning",onClick:H})]}),(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("span",{className:"input-group-text",id:"filter",title:"Filter",children:(0,j.jsx)(I.JO,{icon:"codicon:search"})}),(0,j.jsx)("input",{type:"text",className:"form-control",value:s,placeholder:"Filter","aria-describedby":"filter",onChange:function(e){o(e.target.value)},onKeyDown:function(e){"Enter"===e.key?e.target.blur():"Escape"===e.key&&(e.target.blur(),W())}}),s&&(0,j.jsx)(Q,{icon:"carbon:delete",variant:"outline-warning",onClick:W})]})]}),(0,j.jsxs)("div",{className:"d-flex flex-column flex-md-row gap-2",children:[(0,j.jsx)(Q,{className:"",icon:"ph:password",variant:"secondary",title:"Password Generator",onClick:function(){q(!U)}}),(0,j.jsx)(Q,{className:"",icon:"codicon:new-file",variant:"secondary",title:"New Note",onClick:function(){return M.apply(this,arguments)}})]})]}),U&&(0,j.jsx)($e,{}),(0,j.jsx)("div",{className:"d-flex flex-column gap-3",children:X})]})}function Ue(){return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(O,{}),(0,j.jsx)(Z,{children:(0,j.jsxs)(u.VK,{children:[(0,j.jsx)("nav",{className:"navbar navbar-dark bg-dark",children:(0,j.jsxs)("div",{className:"container",children:[(0,j.jsx)(u.rU,{className:"navbar-brand",to:"/",children:"Notebook"}),(0,j.jsx)(P,{})]})}),(0,j.jsx)("div",{className:"container",children:(0,j.jsxs)(d.Z5,{children:[(0,j.jsx)(d.AW,{path:"/login",element:(0,j.jsx)(D,{})}),(0,j.jsx)(d.AW,{path:"/settings",element:(0,j.jsx)(A,{children:(0,j.jsx)(q,{})})}),(0,j.jsx)(d.AW,{path:"*",element:(0,j.jsx)(A,{children:(0,j.jsx)(Le,{})})})]})})]})})]})}var qe=n(3200),Te=new s.u({uri:"/gql"}),Fe=(0,qe.q)((function(e){var t=e.graphQLErrors,n=e.networkError;if(t&&t.forEach((function(e){var t=e.message,n=e.locations,r=e.path,a="[GraphQL error]: Message: ".concat(t,", Location: ").concat(JSON.stringify(n),", Path: ").concat(r);y.Am.error(a),console.error(a)})),n&&401!==n.statusCode){var r="[Network error]: ".concat(n);y.Am.error(r),console.error(r)}})),Ke=new o.f({cache:new i.h,link:(0,c.D)([Fe,Te]),defaultOptions:{watchQuery:{fetchPolicy:"no-cache",errorPolicy:"all"},query:{fetchPolicy:"no-cache",errorPolicy:"all"},mutate:{errorPolicy:"all"}}});(0,a.render)((0,j.jsx)(r.StrictMode,{children:(0,j.jsx)(l.e,{client:Ke,children:(0,j.jsx)(Ue,{})})}),document.getElementById("root"))}},e=>{e.O(0,[39,354],(()=>(7137,e(e.s=7137)))),e.O()}]);